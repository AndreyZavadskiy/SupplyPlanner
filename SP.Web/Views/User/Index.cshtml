@{
    ViewData["Title"] = "Index";
}

<h1>Пользователи</h1>

<div class="col-md-12">
    <section class="container">
        <table id="UserGrid" class="table table-striped table-bordered nowrap" width="100%" cellspacing="0">
            <thead>
                <tr>
                    <th>
                        <input type="checkbox" class="selectAll" />
                    </th>
                    <th></th>
                    <th>Код</th>
                    <th>Фамилия, имя, отчество</th>
                    <th>Роли</th>
                    <th>Территории</th>
                </tr>
            </thead>
        </table>
    </section>
    <section>
        <div class="modal" id="UserForm" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Modal title</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>Modal body text goes here.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary">Save changes</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

@section Scripts
{
    <script>
        $(document).ready(function() {
            var d = new Date();
            var todayString = ("0" + d.getDate()).slice(-2) + "." + ("0" + (d.getMonth() + 1)).slice(-2) + "." + d.getFullYear();
            $('#UserGrid').DataTable({
                language: {
                    url: '/lib/datatables/i18n/russian.json'
                },
                stateSave: true,
                lengthMenu: [
                    [10, 25, 50, 100, -1],
                    [10, 25, 50, 100, "Все"]
                ],
                ajax: {
                    url: '/User/LoadData',
                    type: 'POST',
                    datatype: 'json'
                },
                columns: [
                    { defaultContent: '' },
                    {
                        render: function(data, type, full, meta) {
                            return '<a href=""><img src="/images/pencil-square.svg"/></a>';
                        }
                    },
                    { data: 'code' },
                    { data: 'fullName' },
                    { data: 'roleDescription' },
                    { data: 'territoryDescription' }
                ],
                columnDefs: [
                    {
                        targets: 0,
                        data: null,
                        orderable: false,
                        sorting: false,
                        className: 'select-checkbox',
                        width: '1.5em'
                    },
                    {
                        targets: 1,
                        orderable: false,
                        sorting: false,
                        width: '1.5em'
                    }
                ],
                dom: "<'row'<'col-sm-12 col-md-6 dt-action-group'B>>" +
                    "<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>" +
                    "<'row'<'col-sm-12'tr>>" +
                    "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
                buttons: [
                    {
                        text: 'Добавить',
                        titleAttr: "Создать нового пользователя",
                        className: 'dt-action-button',
                        action: function(e, dt, node, config) {
                            $('#UserForm').modal({
                                backdrop: false,
                                keyboard: false
                            });
                        }
                    },
                    {
                        text: 'Excel',
                        titleAttr: "Выгрузить таблицу в Excel",
                        className: 'dt-action-button',
                        extend: 'excel',
                        title: 'Список пользователей',
                        messageTop: 'Дата выгрузки ' + todayString,
                        exportOptions: {
                            columns: [2, 3, 4, 5]
                        }
                    }
                ],
                select: {
                    style: 'multi',
                    selector: 'td:first-child'
                }
            });
            var dt = $('#UserGrid').DataTable();
            $(".selectAll").on("click",
                function(e) {
                    if ($(this).is(":checked")) {
                        dt.rows().select();
                    } else {
                        dt.rows().deselect();
                    }
                });
        });
    </script>
}